<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SanskritVerse – Bridging Ancient Wisdom</title>

    <!-- 1. Import React & Babel (for in-browser JSX) -->
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <!-- 2. Import Fonts (as requested) -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Serif+Devanagari:wght@400;700&family=Poppins:wght@300;400;600&display=swap" rel="stylesheet">

    <!-- 3. Import Icons (for toggle, voice, etc.) -->
    <script src="https://unpkg.com/@phosphor-icons/web"></script>

    <!-- 4. CSS Styling & Animations -->
    <style>
        /* --- 4.1: Root Variables & Theme --- */
        :root {
            --font-sans: 'Poppins', sans-serif;
            --font-serif-devanagari: 'Noto Serif Devanagari', serif;

            /* Light Mode Palette */
            --color-bg: #fdfaf5; /* Soft Beige */
            --color-text: #333;
            --color-text-secondary: #555;
            --color-primary: #005f73; /* Modern Blue */
            --color-secondary: #d4af37; /* Gold */
            --color-border: #e0d8c7;
            --color-panel-bg: #ffffff;
            --color-header-start: #005f73;
            --color-header-end: #0a9396;
        }

        [data-theme="dark"] {
            /* Dark Mode Palette */
            --color-bg: #121212;
            --color-text: #f1f1f1;
            --color-text-secondary: #b3b3b3;
            --color-primary: #94d2bd; /* Lighter Blue for dark */
            --color-secondary: #e6c149; /* Brighter Gold for dark */
            --color-border: #333;
            --color-panel-bg: #1e1e1e;
            --color-header-start: #94d2bd;
            --color-header-end: #e6c149;
        }

        /* --- 4.2: Global Styles --- */
        *, *::before, *::after {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        html {
            scroll-behavior: smooth;
        }

        body {
            font-family: var(--font-sans);
            background-color: var(--color-bg);
            color: var(--color-text);
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            transition: background-color 0.3s ease, color 0.3s ease;
            overflow-x: hidden; /* Prevent horizontal scroll */
        }

        #root {
            display: flex;
            flex-direction: column;
            flex-grow: 1;
            position: relative;
            z-index: 1;
        }

        main {
            flex-grow: 1;
            padding: 2rem 1rem;
            max-width: 1200px;
            width: 90%;
            margin: 0 auto;
        }

        h1, h2 {
            font-weight: 600;
        }

        /* --- 4.3: Background Animations --- */
        .background-animation {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: -1;
            overflow: hidden;
            pointer-events: none;
        }

        .bg-particle {
            position: absolute;
            bottom: -20px;
            font-family: var(--font-serif-devanagari);
            font-size: 1.2rem;
            color: var(--color-secondary);
            opacity: 0;
            animation: floatUp 15s infinite linear;
        }

        .bg-particle:nth-child(1) { left: 10%; animation-delay: 0s; }
        .bg-particle:nth-child(2) { left: 20%; animation-delay: 3s; font-size: 1.5rem; }
        .bg-particle:nth-child(3) { left: 30%; animation-delay: 5s; }
        .bg-particle:nth-child(4) { left: 50%; animation-delay: 2s; font-size: 1.8rem; }
        .bg-particle:nth-child(5) { left: 70%; animation-delay: 8s; }
        .bg-particle:nth-child(6) { left: 85%; animation-delay: 12s; font-size: 1.4rem; }

        @keyframes floatUp {
            0% {
                transform: translateY(0) translateX(0);
                opacity: 0;
            }
            10% {
                opacity: 0.3;
            }
            90% {
                opacity: 0.3;
            }
            100% {
                transform: translateY(-100vh) translateX(50px);
                opacity: 0;
            }
        }

        /* --- 4.4: Header & Theme Toggle --- */
        .header {
            padding: 1.5rem 2rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 1px solid var(--color-border);
            width: 90%;
            max-width: 1200px;
            margin: 1rem auto 0 auto;
            border-radius: 8px;
            background: rgba(255,255,255,0.05); /* Subtle glassmorphism */
            backdrop-filter: blur(5px);
        }

        .header h1 {
            font-size: 1.8rem;
            font-weight: 400;
            background: linear-gradient(90deg, var(--color-header-start), var(--color-header-end), var(--color-header-start));
            background-size: 200% auto;
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            animation: textShine 5s linear infinite;
        }

        @keyframes textShine {
            to {
                background-position: 200% center;
            }
        }

        .theme-toggle {
            background: none;
            border: none;
            color: var(--color-text);
            font-size: 1.8rem;
            cursor: pointer;
            transition: color 0.3s ease, transform 0.3s ease;
        }

        .theme-toggle:hover {
            color: var(--color-secondary);
            transform: scale(1.1) rotate(15deg);
        }

        /* --- 4.5: Translator UI --- */
        .translator-container {
            display: grid;
            /* New: Added column for swap button */
            grid-template-columns: 1fr auto 1fr;
            gap: 1rem;
            margin-top: 2rem;
            align-items: center;
        }

        .swap-button-container {
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .swap-button {
            background: var(--color-panel-bg);
            border: 1px solid var(--color-border);
            border-radius: 50%;
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            color: var(--color-primary);
            font-size: 1.5rem;
            transition: all 0.3s ease;
        }

        .swap-button:hover {
            background: var(--color-primary);
            color: var(--color-panel-bg);
            transform: scale(1.1) rotate(180deg);
            box-shadow: 0 4px 10px rgba(0,0,0,0.1);
        }

        .panel {
            background: var(--color-panel-bg);
            border: 1px solid var(--color-border);
            border-radius: 8px;
            padding: 1.5rem;
            min-height: 300px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.03);
            transition: border-color 0.3s ease, box-shadow 0.3s ease, transform 0.3s ease;
            display: flex;
            flex-direction: column;
        }

        .panel:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 20px rgba(0,0,0,0.05);
        }

        .panel h2 {
            font-size: 1.2rem;
            color: var(--color-text-secondary);
            margin-bottom: 1rem;
            font-weight: 400;
        }

        .panel textarea {
            flex-grow: 1;
            width: 100%;
            border: none;
            background: none;
            resize: none;
            color: var(--color-text);
            outline: none;
            padding: 0.5rem;
            border-left: 3px solid transparent;
            transition: border-color 0.3s ease;
        }

        /* New: Font utility classes */
        .font-sanskrit {
            font-family: var(--font-serif-devanagari);
            font-size: 1.5rem;
        }

        .font-english {
            font-family: var(--font-sans);
            font-size: 1.1rem;
            line-height: 1.7;
        }

        .panel textarea:focus {
            border-left: 3px solid var(--color-primary);
        }

        .panel textarea::placeholder {
            color: var(--color-text-secondary);
            opacity: 0.6;
            font-style: italic;
        }

        .output-panel-content {
            flex-grow: 1;
            padding: 0.5rem;
            white-space: pre-wrap; /* Preserve newlines */
            animation: fadeIn 0.5s ease-out;
        }

        .output-placeholder {
            color: var(--color-text-secondary);
            opacity: 0.6;
            padding: 0.5rem;
            font-style: italic;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* --- 4.6: Controls & Loader --- */
        .controls-bar {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: 1.5rem;
            padding: 0 0.5rem;
        }
        
        .icon-buttons {
            display: flex;
            gap: 1rem;
        }

        .icon-buttons button {
            background: none;
            border: none;
            font-size: 1.5rem;
            color: var(--color-text-secondary);
            cursor: pointer;
            transition: color 0.3s ease, transform 0.3s ease;
        }

        .icon-buttons button:hover {
            color: var(--color-primary);
            transform: scale(1.1);
        }
        
        /* New: Style for active listening button */
        .icon-buttons button.listening {
            color: #e63946; /* A distinct red color */
            animation: pulse 1.5s infinite;
        }

        @keyframes pulse {
            0% {
                transform: scale(1);
                opacity: 1;
            }
            50% {
                transform: scale(1.2);
                opacity: 0.7;
            }
            100% {
                transform: scale(1);
                opacity: 1;
            }
        }
        
        .icon-buttons button:disabled {
            color: var(--color-border);
            cursor: not-allowed;
            transform: none;
        }

        .translate-button {
            font-family: var(--font-sans);
            font-size: 1rem;
            font-weight: 600;
            background: var(--color-primary);
            color: white;
            border: none;
            border-radius: 8px;
            padding: 0.8rem 1.8rem;
            cursor: pointer;
            transition: background-color 0.3s ease, box-shadow 0.3s ease, transform 0.2s ease;
            box-shadow: 0 4px 10px rgba(0,0,0,0.1);
        }

        .translate-button:hover {
            background: var(--color-header-end);
            box-shadow: 0 6px 15px rgba(0, 95, 115, 0.3);
        }

        .translate-button:active {
            transform: scale(0.98);
        }
        
        .translate-button:disabled {
             background: var(--color-text-secondary);
             cursor: not-allowed;
             box-shadow: none;
        }

        .translate-button.translation-success {
            animation: successGlow 1s ease-out;
        }

        @keyframes successGlow {
            0% {
                box-shadow: 0 4px 10px rgba(0,0,0,0.1);
            }
            50% {
                background: var(--color-header-end);
                box-shadow: 0 6px 25px rgba(212, 175, 55, 0.7); /* Gold glow */
                transform: scale(1.02);
            }
            100% {
                box-shadow: 0 4px 10px rgba(0,0,0,0.1);
                transform: scale(1);
            }
        }

        .loader-container {
            display: flex;
            justify-content: center;
            align-items: center;
            flex-grow: 1;
        }

        .loader {
            font-family: var(--font-serif-devanagari);
            font-size: 3rem;
            color: var(--color-primary);
            animation: spin 1.5s linear infinite;
        }

        @keyframes spin {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }

        /* --- 4.7: Extra Sections (About, Footer) --- */
        .about-section {
            margin-top: 4rem;
            padding: 2rem;
            background: var(--color-panel-bg);
            border: 1px solid var(--color-border);
            border-radius: 8px;
            animation: fadeUpIn 1s ease-out;
            animation-fill-mode: both;
            animation-delay: 0.2s; /* Stagger it slightly */
        }

        @keyframes fadeUpIn {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .about-section h2 {
            font-size: 1.8rem;
            color: var(--color-primary);
            margin-bottom: 1rem;
        }

        .about-section p {
            font-size: 1.1rem;
            line-height: 1.8;
            color: var(--color-text-secondary);
        }

        .footer {
            text-align: center;
            padding: 2rem;
            margin-top: 4rem;
            border-top: 1px solid var(--color-border);
            color: var(--color-text-secondary);
        }

        .footer nav {
            display: flex;
            justify-content: center;
            gap: 1.5rem;
        }

        .footer a {
            color: var(--color-text-secondary);
            text-decoration: none;
            transition: color 0.3s ease;
        }

        .footer a:hover {
            color: var(--color-primary);
            text-decoration: underline;
        }

        /* --- 4.8: Easter Egg Animation --- */
        /* Removed the old easter egg styling */


        /* --- 4.9: Responsive Design --- */
        @media (max-width: 900px) {
            .translator-container {
                /* Stack panels vertically, but put swap button between them */
                grid-template-columns: 1fr;
                gap: 0.5rem;
            }
            
            .swap-button-container {
                /* Make button horizontal and rotate icon */
                padding: 0.5rem 0;
            }
            
            .swap-button {
                transform: rotate(90deg);
            }
            
            .swap-button:hover {
                 transform: scale(1.1) rotate(90deg);
            }

            .header h1 {
                font-size: 1.3rem;
            }
        }

        @media (max-width: 600px) {
            .header {
                flex-direction: column;
                gap: 1rem;
                padding: 1rem;
                width: 100%;
                margin: 0;
                border-radius: 0;
            }

            .header h1 {
                font-size: 1.1rem;
                text-align: center;
            }

            .controls-bar {
                flex-direction: column-reverse;
                gap: 1.5rem;
                align-items: stretch;
            }

            .translate-button {
                width: 100%;
            }

            .icon-buttons {
                justify-content: center;
            }
        }

    </style>
</head>
<body>

    <!-- 5. React Root Element -->
    <div id="root"></div>

    <!-- 6. React/JSX Code -->
    <script type="text/babel">
        const { useState, useEffect, useRef } = React;

        // --- Helper Components ---

        // 6.1: Background Animation Component
        const BackgroundAnimation = () => (
            <div className="background-animation">
                <span className="bg-particle">अ</span>
                <span className="bg-particle">इ</span>
                <span className="bg-particle">ॐ</span>
                <span className="bg-particle">क</span>
                <span className="bg-particle">ग</span>
                <span className="bg-particle">म</span>
            </div>
        );

        // 6.2: Loader Component
        const Loader = () => (
            <div className="loader-container">
                <div className="loader">ॐ</div>
            </div>
        );

        // 6.4: Header Component
        const Header = ({ theme, toggleTheme }) => (
            <header className="header">
                <h1>SanskritVerse – Bridging Ancient Wisdom and Modern Understanding</h1>
                <button 
                    className="theme-toggle" 
                    onClick={toggleTheme}
                    title={theme === 'light' ? 'Switch to Dark Mode' : 'Switch to Light Mode'}
                >
                    <i className="ph-fill ph-moon-stars"></i>
                </button>
            </header>
        );

        // 6.5: Translator Component
        const Translator = ({ 
            inputText, 
            setInputText, 
            outputText, 
            isLoading, 
            translationMode,
            swapLanguages
        }) => {
            
            const isSktToEn = translationMode === 'skt-to-en';
            
            const inputHeader = isSktToEn ? 'Enter Sanskrit Text' : 'Enter English Text';
            const outputHeader = isSktToEn ? 'English Translation' : 'Sanskrit Translation';
            
            const inputClass = isSktToEn ? 'font-sanskrit' : 'font-english';
            const outputClass = isSktToEn ? 'font-english' : 'font-sanskrit';
            
            const inputPlaceholder = isSktToEn 
                ? "Type or paste Sanskrit here... (e.g., सर्वे भवन्तु सुखिनः)" 
                : "Type or paste English here... (e.g., May all beings be happy)";

            return (
                <div className="translator-container">
                    {/* Left Panel: Input */}
                    <div className="panel">
                        <h2>{inputHeader}</h2>
                        <textarea
                            value={inputText}
                            onChange={(e) => setInputText(e.target.value)}
                            className={inputClass}
                            placeholder={inputPlaceholder}
                        ></textarea>
                    </div>

                    {/* Swap Button */}
                    <div className="swap-button-container">
                        <button 
                            className="swap-button" 
                            title="Swap languages"
                            onClick={swapLanguages}
                        >
                            <i className="ph ph-arrows-left-right"></i>
                        </button>
                    </div>

                    {/* Right Panel: Output */}
                    <div className="panel">
                        <h2>{outputHeader}</h2>
                        {isLoading ? (
                            <Loader />
                        ) : (
                            outputText ? (
                                <p className={`output-panel-content ${outputClass}`}>{outputText}</p>
                            ) : (
                                <p className="output-placeholder">Translation will appear here...</p>
                            )
                        )}
                    </div>
                </div>
            );
        };

        // 6.6: About Section Component
        const AboutSection = () => (
            <section className="about-section">
                <h2>How SanskritVerse Works</h2>
                <p>
                    SanskritVerse uses a state-of-the-art machine learning model (currently simulated) to provide
                    real-time translations from Sanskrit to English. We focus on preserving the nuances
                    and diacritics of the original text, aiming to make ancient wisdom more accessible
                    to the modern world. Our platform is built with a clean, responsive, and interactive
                    design to provide a seamless and enjoyable experience.
                </p>
            </section>
        );

        // 6.7: Footer Component
        const Footer = () => (
            <footer className="footer">
                <nav>
                    <a href="#">Privacy Policy</a>
                    <a href="#">Contact</a>
                    <a href="#">Contribute</a>
                </nav>
            </footer>
        );


        // --- Main App Component ---
        // 6.8: App
        const App = () => {
            const [theme, setTheme] = useState('light');
            const [translationMode, setTranslationMode] = useState('skt-to-en'); // 'skt-to-en' or 'en-to-skt'
            const [inputText, setInputText] = useState('');
            const [outputText, setOutputText] = useState('');
            const [isLoading, setIsLoading] = useState(false);
            const [isListening, setIsListening] = useState(false); // New state for listening
            const buttonRef = useRef(null); // Ref for the translate button
            const recognitionRef = useRef(null); // Ref for SpeechRecognition instance

            // Effect to apply theme to body
            useEffect(() => {
                document.body.dataset.theme = theme;
            }, [theme]);

            // New: Initialize SpeechRecognition
            useEffect(() => {
                if (!('SpeechRecognition' in window || 'webkitSpeechRecognition' in window)) {
                    console.error("Speech recognition not supported by this browser.");
                    return; // Don't initialize if not supported
                }
                
                const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
                const recognition = new SpeechRecognition();
                recognition.continuous = false;
                recognition.interimResults = false;
                
                recognition.onstart = () => {
                    setIsListening(true);
                };
                
                recognition.onresult = (event) => {
                    const transcript = event.results[0][0].transcript;
                    setInputText(transcript); // Set input text with transcript
                };
                
                recognition.onerror = (event) => {
                    console.error("Speech recognition error:", event.error);
                    setIsListening(false);
                };
                
                recognition.onend = () => {
                    setIsListening(false);
                };
                
                recognitionRef.current = recognition;

            }, []); // Run only once on mount

            // Toggle theme
            const toggleTheme = () => {
                setTheme(theme === 'light' ? 'dark' : 'light');
            };

            // Swap Languages
            const swapLanguages = () => {
                setTranslationMode(mode => mode === 'skt-to-en' ? 'en-to-skt' : 'skt-to-en');
                // Swap text content between input and output
                setInputText(outputText);
                setOutputText(inputText);
            };

            // Text-to-Speech Function
            const handleTextToSpeech = () => {
                if (!outputText || !('speechSynthesis' in window)) {
                    console.error("Speech synthesis not supported or no text to speak.");
                    return;
                }
                
                // Stop any previous speech
                window.speechSynthesis.cancel();
                
                const utterance = new SpeechSynthesisUtterance(outputText);
                
                // Set language based on output
                // Use 'hi-IN' for Devanagari (Sanskrit 'sa-IN' is often not supported)
                utterance.lang = (translationMode === 'skt-to-en') ? 'en-US' : 'hi-IN';
                
                window.speechSynthesis.speak(utterance);
            };

            // New: Voice Input Function
            const handleVoiceInput = () => {
                if (!recognitionRef.current) {
                    console.error("Speech recognition not initialized.");
                    return;
                }
                
                if (isListening) {
                    recognitionRef.current.stop();
                } else {
                    // Set language based on input mode
                    recognitionRef.current.lang = (translationMode === 'skt-to-en') ? 'hi-IN' : 'en-US';
                    try {
                        recognitionRef.current.start();
                    } catch (err) {
                        console.error("Error starting recognition:", err);
                    }
                }
            };

            // Mock Translation Function
            const handleTranslate = () => {
                if (!inputText.trim()) return;

                setIsLoading(true);
                setOutputText(''); // Clear previous translation

                // Mock API call
                setTimeout(() => {
                    let mockTranslation = "";
                    
                    if (translationMode === 'skt-to-en') {
                        mockTranslation = `(Mock Translation for "${inputText}") "May all beings be happy and prosperous."`;
                    } else {
                        mockTranslation = `(Mock Translation for "${inputText}") सर्वे भवन्तु सुखिनः`;
                    }
                    
                    setOutputText(mockTranslation);
                    setIsLoading(false);

                    // Trigger button success animation
                    if (buttonRef.current) {
                        buttonRef.current.classList.add('translation-success');
                        setTimeout(() => {
                            if (buttonRef.current) {
                                buttonRef.current.classList.remove('translation-success');
                            }
                        }, 1000); // Animation duration is 1s
                    }

                }, 1500); // Simulate 1.5 second delay
            };

            return (
                <React.Fragment>
                    <BackgroundAnimation />
                    <Header theme={theme} toggleTheme={toggleTheme} />
                    <main>
                        <Translator
                            inputText={inputText}
                            setInputText={setInputText}
                            outputText={outputText}
                            isLoading={isLoading}
                            translationMode={translationMode}
                            swapLanguages={swapLanguages}
                        />
                        
                        <div className="controls-bar">
                            <div className="icon-buttons">
                                <button 
                                    title="Voice Input"
                                    onClick={handleVoiceInput}
                                    className={isListening ? 'listening' : ''}
                                    disabled={!recognitionRef.current} // Disable if API not supported
                                >
                                    <i className="ph ph-microphone"></i>
                                </button>
                                <button 
                                    title="Speak Translation"
                                    onClick={handleTextToSpeech}
                                    disabled={!outputText || isLoading}
                                >
                                    <i className="ph ph-speaker-high"></i>
                                </button>
                            </div>
                            <button 
                                className="translate-button" 
                                onClick={handleTranslate}
                                disabled={isLoading || !inputText}
                                ref={buttonRef}
                            >
                                {isLoading ? 'Translating...' : 'Translate'}
                            </button>
                        </div>

                        <AboutSection />
                    </main>
                    <Footer />
                </React.Fragment>
            );
        };

        // 7. Render the App
        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);

    </script>
</body>
</html>
